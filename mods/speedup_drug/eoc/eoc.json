[
  {
    "//1": "効果時間の終了時に時間を進める。",
    "//2": "time_since_cataclysmに値を代入すると値がずれるので",
    "//3": "トリッキーなことをしている。",
    "id": "EOC_FIX_TIME",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "_tsc", "=", "u_val('time_since_cataclysm: turns')" ] },
      {
        "//1": "ここで値をずらして元の値との差分をとる。",
        "//2": "ゲーム開始時の大変動開始日の値が影響している。",
        "math": [ "u_val('time_since_cataclysm: turns')", "+=", "0" ]
      },
      { "math": [ "_diff", "=", "_tsc - u_val('time_since_cataclysm: turns')" ] },
      {
        "//": "値の代入時にまたずれるので値を2倍に。",
        "math": [ "_diff", "*=", "2" ]
      },
      { "math": [ "u_val('time_since_cataclysm: turns')", "+=", "_diff + v_compensation" ] }
    ]
  },
  {
    "//1": " '[' キーで変異メニューを出して特質を選択、",
    "//2": "残り時間を表示する｡",
    "id": "EOC_SHOW_LIMIT_TIME",
    "type": "effect_on_condition",
    "condition": {
      "not": {
        "u_has_any_trait" : [
          "SD_SPEEDUP_CRAFT_DAY",
          "SD_SPEEDUP_CRAFT_WEEK",
          "SD_SPEEDUP_CRAFT_MONTH",
          "SD_SPEEDUP_CRAFT_YEAR",
          "SD_SPEEDUP_LEARN_DAY",
          "SD_SPEEDUP_LEARN_WEEK",
          "SD_SPEEDUP_LEARN_MONTH",
          "SD_SPEEDUP_LEARN_YEAR"
        ]
      }
    },
    "effect": { "u_message": "このメッセージが表示された場合は、バグが発生しています。" },
    "false_effect": [
      { "math": [ "tmp_remain_minutes", "=", "u_count_time_minutes - u_sd_counter" ] },
      { "math": [ "tmp_limit_time_hour", "=", "floor(tmp_remain_minutes / 60)" ] },
      { "math": [ "tmp_limit_time_minute", "=", "tmp_remain_minutes % 60" ] },
      { "u_message": "残り時間は<global_val:tmp_limit_time_hour>時間<global_val:tmp_limit_time_minute>分です。" }
    ]
  },
  {
    "id": "EOC_LOSE_SPEEDUP_TRAIT",
    "type": "effect_on_condition",
    "effect": [
      { "u_lose_trait" : "SD_SPEEDUP_CRAFT_DAY" },
      { "u_lose_trait" : "SD_SPEEDUP_CRAFT_WEEK" },
      { "u_lose_trait" : "SD_SPEEDUP_CRAFT_MONTH" },
      { "u_lose_trait" : "SD_SPEEDUP_CRAFT_YEAR" },
      { "u_lose_trait" : "SD_SPEEDUP_LEARN_DAY" },
      { "u_lose_trait" : "SD_SPEEDUP_LEARN_WEEK" },
      { "u_lose_trait" : "SD_SPEEDUP_LEARN_MONTH" },
      { "u_lose_trait" : "SD_SPEEDUP_LEARN_YEAR" }
    ]
  },
  {
    "id": "EOC_CHECK_SPEEDUP",
    "type": "effect_on_condition",
    "recurrence": "1 minutes",
    "condition": { "math": [ "u_is_being_speedup", "==", "1" ] },
    "deactivate_condition": { "math": [ "u_is_being_speedup", "==", "0" ] },
    "effect": [
      { "run_eocs": [ "EOC_CHECK_END_SPEEDUP" ] }
    ]
  },
  {
    "id": "EOC_CHECK_END_SPEEDUP",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_sd_counter <= u_count_time_minutes" ] },
    "effect": { "math": [ "u_sd_counter", "++" ] },
    "false_effect": {
      "run_eocs": [ "EOC_END_SPEEDUP" ]
    }
  },
  {
    "id": "EOC_END_SPEEDUP",
    "type": "effect_on_condition",
    "effect": [
      {
        "run_eoc_with": "EOC_FIX_TIME",
        "variables": {
          "compensation": "u_add_turns_compensation"
        }
      },
      { "run_eocs": [ "EOC_LOSE_SPEEDUP_TRAIT" ] },
      { "u_message": "時間の流れが戻りました。", "type": "bad" },
      { "math": [ "u_is_being_speedup", "=", "0" ] }
    ]
  }
]
